@page "/artists"
@using Bashi.Core.Enums
@using Mandarin.Services
@using Mandarin.Models.Artists
@using System.Reactive.Linq
@inject IArtistService ArtistService;
@inject NavigationManager NavigationManager;

<Card>
  <CardHeader>
    <CardTitle>All Artists</CardTitle>
    <CardActions Float="Float.Right">
      <Button Color="Color.Primary" Clicked="@OnNewClicked">New</Button>
    </CardActions>
  </CardHeader>
  <CardBody>
    @if (data == null || data.Count == 0)
    {
      <Progress Size="Size.Medium">
        <ProgressBar Striped="true" Animated="true" Min="0" Max="100" Value="100" Background="@(data == null ? Background.Primary : Background.Danger)">
          @(data == null ? "Fetching artists..." : "No artist data received.")
        </ProgressBar>
      </Progress>
    }
    else
    {
      <div class="overflow-x-auto">
        <DataGrid TItem="Stockist" Data="@data" Filterable="true" ShowPager="true" PageSize="10" Striped="true" Responsive="true"
                  SelectedRowChanged="@OnStockistSelected">
          <DataGridColumn TItem="Stockist" Field="StockistCode" Caption="Code" Width="75px" />
          <DataGridColumn TItem="Stockist" Field="Details.ShortDisplayName" Caption="Name" TextAlignment="TextAlignment.Right" />
          <DataGridColumn TItem="Stockist" Field="StatusCode" Caption="Status" TextAlignment="TextAlignment.Right">
            <DisplayTemplate>@context.StatusCode.GetDescription()</DisplayTemplate>
          </DataGridColumn>
        </DataGrid>
      </div>
    }
  </CardBody>
</Card>

@code
{
  private IList<Stockist> data;

  /// <inheritdoc />
  protected override async Task OnInitializedAsync()
  {
    await base.OnInitializedAsync();

    data = await ArtistService.GetArtistsForCommissionAsync().ToList();
  }

  private void OnNewClicked()
  {
    NavigationManager.NavigateTo("/artists/new");
  }

  private void OnStockistSelected(Stockist selectedStockist)
  {
    NavigationManager.NavigateTo($"/artists/edit/{selectedStockist.StockistCode}");
  }
}
