@page "/artists"
@using Mandarin.ViewModels.Artists
@inject IArtistsPageViewModel ViewModel

@if (ViewModel.IsLoading)
{
  <p>Just a moment...</p>
}
else
{
  <div class="grid grid-flow-row-dense grid-cols-3 sm:grid-cols-5 gap-4">
    @foreach (var viewModel in @ViewModel.ViewModels)
    {
      <MandarinArtistThumbnail ViewModel="@viewModel" Clicked="@(() => OnSelected(viewModel))" />
      <MandarinArtist ViewModel="viewModel" IsVisible="@(SelectedViewModel == viewModel)" />
    }
  </div>
}

@code {

  private IArtistViewModel SelectedViewModel { get; set; }

  /// <inheritdoc />
  protected override void OnInitialized()
  {
    ViewModel.StateObservable.Subscribe(x => InvokeAsync(StateHasChanged));
  }

  private void OnSelected(IArtistViewModel viewModel)
  {
    this.SelectedViewModel = this.SelectedViewModel == viewModel ? null : viewModel;
  }

}
